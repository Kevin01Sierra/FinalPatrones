drop database parqueadero;
create database parqueadero;
use parqueadero;

-- Creaci贸n de la tabla Usuario
CREATE TABLE Usuario (
    Id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    Nombre VARCHAR(50) NOT NULL,
    Identificacion VARCHAR(50) NOT NULL,
    Contrasena VARCHAR(50) NOT NULL,
    Correo VARCHAR(50) NOT NULL,
    Estado BOOLEAN NOT NULL DEFAULT TRUE,
    Usuario VARCHAR(50) NOT NULL,
    Fecha_creacion DATE DEFAULT (CURRENT_DATE),
    Num_intentos INT NOT NULL,
    Cod_verificacion VARCHAR(6) NOT NULL,
    Puntos INT NOT NULL DEFAULT 0
);

-- Creaci贸n de la tabla Tarjeta_credito
CREATE TABLE Tarjeta_credito (
    Id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    Numero VARCHAR(50) NOT NULL,
    Nombre_propietario VARCHAR(50) NOT NULL,
    CVC VARCHAR(3) NOT NULL,
    Fecha_vencimiento DATE NOT NULL,
    Usuario_fk INT UNSIGNED,
    Fecha_creacion DATE DEFAULT (CURRENT_DATE),
    FOREIGN KEY (Usuario_fk) REFERENCES Usuario(Id)
);

-- Creaci贸n de la tabla tipo_usuario
CREATE TABLE Tipo_usuario (
    Id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    Tipo VARCHAR(30) NOT NULL,
    Fecha_creacion DATE DEFAULT (CURRENT_DATE),
    Usuario_fk INT UNSIGNED,
    FOREIGN KEY (Usuario_fk) REFERENCES Usuario(Id)
);

-- Creaci贸n de la tabla Ip
CREATE TABLE Ip (
    Id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    Direccion_ip VARCHAR(50) NOT NULL,
    Usuario_fk INT UNSIGNED,
    Fecha_creacion DATE NOT NULL DEFAULT (CURRENT_DATE),
    FOREIGN KEY (Usuario_fk) REFERENCES Usuario(Id)
);

CREATE TABLE Ciudad (
    Id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    Nombre VARCHAR(255) NOT NULL,
    Coordenada POINT,
    Fecha_creacion DATE DEFAULT (CURRENT_DATE)
);

CREATE TABLE Tipo_parqueadero (
    Id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    Tipo VARCHAR(255) NOT NULL,
    Fecha_creacion DATE DEFAULT (CURRENT_DATE)
);

CREATE TABLE Vehiculo (
    Id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    Tipo VARCHAR(255),
    Fecha_creacion DATE DEFAULT (CURRENT_DATE)
);

CREATE TABLE Parqueadero (
    Id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    Nombre VARCHAR(255),
    Cupo_moto_total INT NOT NULL DEFAULT 0,
    Cupo_carro_total INT NOT NULL DEFAULT 0,
    Cupo_bici_total INT NOT NULL DEFAULT 0,
    Ciudad_fk INT UNSIGNED,
    Tipo_fk INT UNSIGNED,
    Coordenada POINT,
    Cupo_uti_moto INT NOT NULL DEFAULT 0,
    Cupo_uti_carro INT NOT NULL DEFAULT 0,
    Cupo_uti_bici INT NOT NULL DEFAULT 0,
    Fecha_creacion DATE DEFAULT (CURRENT_DATE),
    FOREIGN KEY (Ciudad_fk) REFERENCES Ciudad(Id),
    FOREIGN KEY (Tipo_fk) REFERENCES Tipo_parqueadero(Id)
);

CREATE TABLE Cupo (
    Id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    Usuario_fk INT UNSIGNED,
    Parqueadero_fk INT UNSIGNED,
    Vehiculo_fk INT UNSIGNED,
    Pagado BOOLEAN DEFAULT FALSE,
    Hora_llegada DATE,
    Hora_salida DATE,
    horas_pedidas INT,
    Fecha_creacion DATE DEFAULT (CURRENT_DATE),
    FOREIGN KEY (Usuario_fk) REFERENCES Usuario(Id),
    FOREIGN KEY (Parqueadero_fk) REFERENCES Parqueadero(Id),
    FOREIGN KEY (Vehiculo_fk) REFERENCES Vehiculo(Id)
);

CREATE TABLE Cupo_offline (
    Id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    status ENUM('DISPONIBLE', 'OCUPADO') NOT NULL DEFAULT 'DISPONIBLE',
    Parqueadero_fk INT UNSIGNED,
    Vehiculo_fk INT UNSIGNED,
    Pagado BOOLEAN DEFAULT FALSE,
    Hora_llegada DATE,
    Hora_salida DATE,
    Fecha_creacion DATE DEFAULT (CURRENT_DATE),
    FOREIGN KEY (Parqueadero_fk) REFERENCES Parqueadero(Id),
    FOREIGN KEY (Vehiculo_fk) REFERENCES Vehiculo(Id)
);

CREATE TABLE Tarifa (
    Id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    Valor_ordinario INT,
    Parqueadero_fk INT UNSIGNED,
    Vehiculo_fk INT UNSIGNED,
    Valor_mora INT,
    Fecha_creacion DATE DEFAULT (CURRENT_DATE),
    FOREIGN KEY (Parqueadero_fk) REFERENCES Parqueadero(Id),
    FOREIGN KEY (Vehiculo_fk) REFERENCES Vehiculo(Id)
);
